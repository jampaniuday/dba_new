-----------------------------------------------------
--- Creation Date: 15-Apl-2004
--- Last Update : 16-Apl-2004
--- Aouthor : Isaac Raz
--- Company : Traiana Inc
--- Script Target:
---	Update Database schema 1.7 STF 12.1 Build 3 to 1.7 STF 12.1 Build 4 on JPMC project
---	** CR 5556 (Enables Flat protocol to support options)
---	** Schema 1.7 STF 12.1 Build 3 is identical to schema 1.7 STF 12.1 Build 2
------------------------------------------------------

INSERT INTO ARCH_VERSION ( TIMESTAMP, VERSION, DESCRIPTION, LOGFILE, SOLUTION_VERSION )
	VALUES (sysdate , '1.7.12.1::4', 'jpmc 1.7 stf 12 build 4', '/Arch2.0/installationLog/databaseInstall.log', '1.7.12.1::4');


begin
	alter_constraints('disable');
end;
/

--------------------- PLATFORM  -----------------------
------ \ARCH_GENERIC_NOE_DEALS\table.sql
ALTER TABLE ARCH_GENERIC_NOE_DEALS ADD (
	F51  VARCHAR2 (255),
	F52  VARCHAR2 (255),
	F53  VARCHAR2 (255),
	F54  VARCHAR2 (255),
	F55  VARCHAR2 (255),
	F56  VARCHAR2 (255),
	F57  VARCHAR2 (255),
	F58  VARCHAR2 (255),
	F59  VARCHAR2 (255),
	F60  VARCHAR2 (255)
);


---------------------- SOLUTION -------------------------
------- \ARCH_FLOW_DEF
INSERT INTO ARCH_FLOW_DEF ( ID, NAME, FLOW_CLASS, FLOW_MODE ) 
        VALUES ( 2000000, 'Dummy Flow', 'UnimplementedDummyFlow', 1); 


------- \ARCH_MSG_GROUP_DETAIL
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID )
	VALUES ( 1000100, 1000099);
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
	VALUES ( 1000600, 1100050);
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000001, 1100113); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000001, 1100100); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000200, 1100100); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000200, 1100101); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000001, 1100114); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000200, 1100102); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000200, 1100103); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000500, 1100104); 
INSERT INTO ARCH_MSG_GROUP_DETAIL ( MSG_GROUP_ID, PROTOCOL_MSG_ID ) 
        VALUES ( 1000500, 1100105); 



------- \ARCH_MSG_LOGIC_INFO
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID )
	VALUES ( 1000098, 11, 'IRFE EOD Protocol', NULL, 1000065);
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
	VALUES ( 1100050, 11, 'BonyIntegration', NULL, 1100050);
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
        VALUES ( 1100115, 3, 'New Option NOE Sync', 1100015, 1000002); 
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
        VALUES ( 2000000, 1, 'Dummy Logic Info', NULL, 2000000); 
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
        VALUES ( 1100116, 3, 'New Option Split Sync', 1000004, 1000005); 
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
        VALUES ( 1100117, 3, 'Modify Option Noe Sync', 1100013, 1000003); 
INSERT INTO ARCH_MSG_LOGIC_INFO ( ID, ATTR, DESCRIPTION, PRE_FLOW_ID, FLOW_ID ) 
        VALUES ( 1100118, 3, 'Modify Option Split Sync', 1000033, 1000034); 

------- \ARCH_MSG_PROTOCOL_INFO
UPDATE ARCH_MSG_PROTOCOL_INFO SET 
	IN_TRANSFORMER='FlatJPMC-Xml'
WHERE ID IN (1100003,1100004,1100005);

INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME ) 
        VALUES ( 1100104, 2000000, 'Harmony_To_TRM_CSV', 'Harmony_To_TRM_CSV', 'Harmony Protocol', 'Harmony Protocol Protocol'); 
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME ) 
        VALUES ( 1100105, 2000000, 'Harmony_To_TRM_CSV', 'Harmony_To_TRM_CSV', 'Harmony Protocol 2', 'Harmony Protocol 2'); 
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
	VALUES ( 1100050, 1100050, NULL, NULL, 'Bony Integration Excel File', 'BonyIntegration');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100113, 1100115, 'FlatOptionNoeJPMC-Xml', 'JPMC_OptionFlat2_CSV', 'New Option Noe (Xml)', 'NewOptionNoeXml');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100100, 2000000, 'JPMC_OptionFlat2_CSV', 'JPMC_OptionFlat2_CSV', 'Option Noe Flat Protocol', 'Option Noe Flat Protocol');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100101, 2000000, 'JPMC_OptionFlat2_CSV', 'JPMC_OptionFlat2_CSV', 'Option Noe Flat Protocol 2', 'Option Noe Flat Protocol 2');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100114, 1100116, 'FlatOptionSplitJPMC-Xml', 'JPMC_OptionFlat2_CSV', 'New Option Split (Xml)', 'NewOptionSplitXml');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100115, 1100117, 'FlatOptionNoeJPMC-Xml', 'JPMC_OptionFlat2_CSV', 'Modify Option Noe (Xml)', 'ModifyOptionNoeXml');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100116, 1100014, 'FlatOptionNoeJPMC-Xml', 'JPMC_OptionFlat2_CSV', 'Delete Option Noe (Xml)', 'DeleteOptionNoeXml');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100117, 1100118, 'FlatOptionSplitJPMC-Xml', 'JPMC_OptionFlat2_CSV', 'Modify Option Split (Xml)', 'ModifyOptionSplitXml');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100102, 2000000, 'JPMC_Flat2_CSV', 'JPMC_Flat2_CSV', 'Linear Noe Flat Protocol', 'Linear Noe Flat Protocol');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
        VALUES ( 1100103, 2000000, 'JPMC_Flat2_CSV', 'JPMC_Flat2_CSV', 'Linear Noe Flat Protocol 2', 'Linear Noe Flat Protocol 2');
INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID, LOGIC_MSG_ID, IN_TRANSFORMER, OUT_TRANSFORMER, DESCRIPTION, NAME )
	VALUES ( 1000099, 1000098, 'irfeEODInMsg-DelimiterString', 'irfeEODInMsg-DelimiterString', 'Irfe EOD Settling Trades', 'Irfe EOD Settling Trades');

--INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID,LOGIC_MSG_ID,IN_TRANSFORMER,OUT_TRANSFORMER,DESCRIPTION,NAME )
--	VALUES (1000060,1000026,NULL,NULL,'Check 4 option reconciliation stale','Check4StaleOptionRecon' ) ;
--INSERT INTO ARCH_MSG_PROTOCOL_INFO ( ID,LOGIC_MSG_ID,IN_TRANSFORMER,OUT_TRANSFORMER,DESCRIPTION,NAME )
--	VALUES (1000061,1000027,NULL,NULL,'Check 4 option alocation stale','Check4StaleOptionAllocation' ) ;



------- \ARCH_MSG_TOKEN
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000104  and TOKEN=',SPLIT,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000105  and TOKEN=',SPLIT,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000106  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000107  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000108  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1000109  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1100003  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1100004  and TOKEN=',GIVEUP,';
DELETE ARCH_MSG_TOKEN WHERE PROTOCOL_MSG_ID=1100005  and TOKEN=',GIVEUP,';
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN )
	VALUES ( 1000099, 'DISCOUNT_FACTOR');
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
	VALUES ( 1100050, NULL); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100100, ',OPTION,'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100101, ',OPTIONSPLIT,'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100114, 'operation="InsertOptionSplit"'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100113, 'operation="InsertOptionNoe"'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100102, ',GIVEUP,'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100103, ',SPLIT,');
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100104, ',GIVEUP,'); 
INSERT INTO ARCH_MSG_TOKEN ( PROTOCOL_MSG_ID, TOKEN ) 
        VALUES ( 1100105, ',SPLIT,'); 


begin
	alter_constraints('enable');
end;
/